html
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>The Tropopause: Earth's Atmospheric Conductor</title>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #fffcf5;
            font-family: 'Patrick Hand', cursive;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #container {
            width: 1920px;
            height: 1080px;
            position: relative;
        }

        canvas {
            background-color: #fffcf5;
            display: block;
        }

        #subtitles {
            position: absolute;
            top: 900px;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            text-align: center;
            font-size: 32px;
            color: #333;
        }

        #controls {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255, 252, 245, 0.8);
            padding: 10px;
            text-align: center;
        }

        #timeline {
            width: 60%;
            height: 10px;
            background-color: #ddd;
            cursor: pointer;
            display: inline-block;
        }

        #timeline-progress {
            height: 10px;
            background-color: #3498db;
            width: 0;
        }

        #timecode {
            display: inline-block;
            margin: 0 10px;
        }

        input[type=range] {
            width: 200px;
        }
    </style>
</head>
<body>
<div id="container">
    <canvas id="animationCanvas" width="1920" height="1080"></canvas>
    <div id="subtitles"></div>
    <div id="controls">
        <button id="playPauseBtn">Play</button>
        <span id="timecode">00:00 / 01:00</span>
        <div id="timeline">
            <div id="timeline-progress"></div>
        </div>
        <label for="duration">Duration (30-180s):</label>
        <input type="range" id="duration" min="30" max="180" value="60">
        <button id="exportBtn">Export Video</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('animationCanvas');
    const ctx = canvas.getContext('2d');
    const subtitlesDiv = document.getElementById('subtitles');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const timecodeDisplay = document.getElementById('timecode');
    const timeline = document.getElementById('timeline');
    const timelineProgress = document.getElementById('timeline-progress');
    const durationInput = document.getElementById('duration');
    const exportBtn = document.getElementById('exportBtn');

    let animationFrameId;
    let isPlaying = true;
    let startTime;
    let currentTime = 0;
    let duration = 60;
    let mediaRecorder;
    let recordedChunks = [];

    const narration = [
        { time: 0, text: "Imagine the Earth's atmosphere as a giant orchestra, each layer playing its part in the planet's song." },
        { time: 5, text: "Today, weâ€™re tuning into a special section: the tropopause, an atmospheric boundary you can think of as the conductor." },
        { time: 10, text: "This 'thermal ceiling' separates the troposphere, where all our weather symphonies play out, from the stratosphere, where the ozone layer composes its protective melodies." },
        { time: 15, text: "At the equator, this conductor stands tall, around 17 kilometers high, leading a vibrant performance, but closer to the poles, it lowers to about 9 kilometers." },
        { time: 20, text: "The tropopause is defined as the altitude where the temperature's downward trend slows, dropping less than 2 degrees Celsius per kilometer and staying that way for 2 kilometers." },
        { time: 25, text: "Changes in temperature below in the troposphere or above in the stratosphere directly impact the tropopause's height and temperature." },
        { time: 30, text: "And just as musicians sometimes improvise, scientists also use a dynamic definition based on potential vorticity to study how air mixes between these atmospheric layers." },
        { time: 35, text: "Understanding the tropopause is like reading the conductor's score, giving us insights into the Earth's atmospheric dynamics." },
        { time: 40, text: "So, listen closely to the music of the atmosphere, and see if you can hear the tropopause guiding the flow of energy above and below!" },
        { time: 45, text: "" },
        { time: 50, text: "" },
        { time: 55, text: "" }
    ];

    function roughLine(x1, y1, x2, y2, color) {
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.moveTo(x1 + Math.random() * 3, y1 + Math.random() * 3);
        ctx.lineTo(x2 + Math.random() * 3, y2 + Math.random() * 3);
        ctx.stroke();
    }

    function drawStickFigure(x, y, pose, scale, color) {
        ctx.strokeStyle = color;
        ctx.lineWidth = 3;

        switch (pose) {
            case 'idle':
                // Head
                ctx.beginPath();
                ctx.arc(x, y - 50 * scale, 20 * scale, 0, 2 * Math.PI);
                ctx.stroke();

                // Body
                roughLine(x, y - 30 * scale, x, y + 50 * scale, color);

                // Arms
                roughLine(x, y, x - 30 * scale, y + 20 * scale, color);
                roughLine(x, y, x + 30 * scale, y + 20 * scale, color);

                // Legs
                roughLine(x, y + 50 * scale, x - 20 * scale, y + 100 * scale, color);
                roughLine(x, y + 50 * scale, x + 20 * scale, y + 100 * scale, color);
                break;
            case 'thinking':
                // Head
                ctx.beginPath();
                ctx.arc(x, y - 50 * scale, 20 * scale, 0, 2 * Math.PI);
                ctx.stroke();

                // Body
                roughLine(x, y - 30 * scale, x, y + 50 * scale, color);

                // Arms (folded)
                roughLine(x, y + 10 * scale, x - 25 * scale, y + 10 * scale, color);
                roughLine(x, y + 10 * scale, x + 25 * scale, y + 10 * scale, color);

                // Legs
                roughLine(x, y + 50 * scale, x - 20 * scale, y + 100 * scale, color);
                roughLine(x, y + 50 * scale, x + 20 * scale, y + 100 * scale, color);
                break;
            case 'running':
                 // Head
                 ctx.beginPath();
                 ctx.arc(x, y - 50 * scale, 20 * scale, 0, 2 * Math.PI);
                 ctx.stroke();

                // Body
                roughLine(x, y - 30 * scale, x, y + 50 * scale, color);

                // Arms
                roughLine(x, y, x - 40 * scale, y - 10 * scale, color);
                roughLine(x, y, x + 40 * scale, y + 30 * scale, color);

                // Legs
                roughLine(x, y + 50 * scale, x - 30 * scale, y + 80 * scale, color);
                roughLine(x, y + 50 * scale, x + 30 * scale, y + 120 * scale, color);
                break;
        }
    }

    function renderScene(time) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        let currentSubtitle = "";
        for (let i = 0; i < narration.length; i++) {
            if (time >= narration[i].time && time < (i === narration.length - 1 ? duration : narration[i + 1].time)) {
                currentSubtitle = narration[i].text;
                break;
            }
        }
        subtitlesDiv.textContent = currentSubtitle;

        if (time >= 0 && time < 5) {
            // Scene 1: Globe with musical notes
            ctx.fillStyle = '#87ceeb';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw globe
            ctx.fillStyle = '#3cb371';
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 300, 0, 2 * Math.PI);
            ctx.fill();

            // Draw music notes
            ctx.fillStyle = '#fff';
            for (let i = 0; i < 20; i++) {
                const x = Math.random() * canvas.width;
                const y = canvas.height / 2 - 300 - Math.random() * 200;
                const size = Math.random() * 20 + 10;
                ctx.beginPath();
                ctx.ellipse(x, y + (time * 10), size/2, size, 0, 0, 2 * Math.PI);
                ctx.fill();
            }
        } else if (time >= 5 && time < 10) {
            // Scene 2: Tropopause layer and conductor
            ctx.fillStyle = '#afeeee';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw globe
             ctx.fillStyle = '#3cb371';
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 300, 0, 2 * Math.PI);
            ctx.fill();

            // Tropopause Layer
            ctx.strokeStyle = 'rgba(255, 255, 255, 0.5)';
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 350, 0, 2 * Math.PI);
            ctx.stroke();

            drawStickFigure(canvas.width * 0.8, canvas.height / 2, 'thinking', 1.5, 'black');

        } else if (time >= 10 && time < 15) {
            // Scene 3: Troposphere and Stratosphere split
            ctx.fillStyle = '#e0ffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Troposphere
            ctx.fillStyle = '#ffa07a';
            ctx.fillRect(0, canvas.height / 2, canvas.width, canvas.height / 2);
             // Raindrops
             ctx.fillStyle = '#ADD8E6';
             for(let i = 0; i < 30; i++) {
                 const x = Math.random() * canvas.width;
                 const y = canvas.height / 2 + Math.random() * canvas.height / 2;
                 ctx.beginPath();
                 ctx.arc(x, y, 3, 0, 2 * Math.PI);
                 ctx.fill();
             }

            // Stratosphere
            ctx.fillStyle = '#dda0dd';
            ctx.fillRect(0, 0, canvas.width, canvas.height / 2);

            // Ozone molecules
            ctx.fillStyle = '#FFD700';
            for (let i = 0; i < 10; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height / 2;
                ctx.beginPath();
                ctx.arc(x, y, 10, 0, 2 * Math.PI);
                ctx.fill();
            }
        } else if (time >= 15 && time < 20) {
            // Scene 4: Equator and Poles height
            ctx.fillStyle = '#f0fff0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Globe
            ctx.fillStyle = '#3cb371';
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 300, 0, 2 * Math.PI);
            ctx.fill();

            // Equator Tropopause
            ctx.strokeStyle = '#000080';
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 350, 0, Math.PI);
            ctx.stroke();
             ctx.font = '24px Patrick Hand';
             ctx.fillStyle = 'black';
             ctx.fillText('17 km', canvas.width / 2 + 360, canvas.height / 4)

            // Poles Tropopause
            ctx.strokeStyle = '#800000';
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 100, 0, Math.PI);
            ctx.stroke();
            ctx.fillText('9 km', canvas.width / 2 + 110, canvas.height / 4*3);

        } else if (time >= 20 && time < 25) {
            // Scene 5: Temperature graph
            ctx.fillStyle = '#ffffe0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Temperature Graph
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(50, canvas.height - 50);
            ctx.lineTo(canvas.width - 50, canvas.height - 50);
            ctx.moveTo(50, canvas.height - 50);
            ctx.lineTo(50, 50);
            ctx.stroke();

            // Temperature Line
            ctx.strokeStyle = '#ff0000';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.moveTo(50, canvas.height - 50);
            ctx.lineTo(canvas.width / 2, 150);
            ctx.stroke();
        } else if (time >= 25 && time < 30) {
            // Scene 6: Dynamic Tropopause
            ctx.fillStyle = '#fff8dc';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Troposphere
            ctx.fillStyle = '#ffa07a';
            ctx.fillRect(0, canvas.height / 2, canvas.width, canvas.height / 2);

            // Stratosphere
            ctx.fillStyle = '#dda0dd';
            ctx.fillRect(0, 0, canvas.width, canvas.height / 2);

            // Tropopause
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(0, canvas.height / 2);
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.stroke();

            // Arrows
            ctx.fillStyle = 'rgba(255, 0, 0, 0.5)';
            ctx.beginPath();
            ctx.moveTo(100, canvas.height / 2 + 50);
            ctx.lineTo(150, canvas.height / 2 + 100);
            ctx.lineTo(150, canvas.height / 2);
            ctx.fill();

            ctx.fillStyle = 'rgba(0, 0, 255, 0.5)';
            ctx.beginPath();
            ctx.moveTo(canvas.width - 100, canvas.height / 2 - 50);
            ctx.lineTo(canvas.width - 150, canvas.height / 2 - 100);
            ctx.lineTo(canvas.width - 150, canvas.height / 2);
            ctx.fill();

        } else if (time >= 30 && time < 35) {
            // Scene 7: Dynamic Definition
            ctx.fillStyle = '#f5f5dc';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Musicians
             drawStickFigure(canvas.width * 0.2, canvas.height / 2, 'idle', 1.5, 'red');
             drawStickFigure(canvas.width * 0.4, canvas.height / 2, 'idle', 1.5, 'blue');

             // Air current
             ctx.strokeStyle = 'rgba(0,0,0,0.3)';
             for(let i = 0; i < 3; i++) {
                 ctx.beginPath();
                 ctx.ellipse(canvas.width/2 + i*50, canvas.height/2 + i*50, 100, 50, 0, 0, 2 * Math.PI)
                 ctx.stroke();
             }

        } else if (time >= 35 && time < 40) {
            // Scene 8: Score
            ctx.fillStyle = '#faf0e6';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Globe
            ctx.fillStyle = '#3cb371';
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 300, 0, 2 * Math.PI);
            ctx.fill();

            // Sheet Music
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            for (let i = 0; i < 5; i++) {
                roughLine(canvas.width * 0.1, canvas.height / 2 - 100 + i * 20, canvas.width * 0.9, canvas.height / 2 - 100 + i * 20, '#000');
            }

        } else if (time >= 40 && time < 45) {
            // Scene 9: Music of Atmosphere
            ctx.fillStyle = '#fffaf0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Energy flow
            ctx.fillStyle = '#ffff00';
            for (let i = 0; i < 20; i++) {
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const size = Math.random() * 10 + 5;
                ctx.beginPath();
                ctx.arc(x, y, size, 0, 2 * Math.PI);
                ctx.fill();
            }
             ctx.strokeStyle = '#000';
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.arc(canvas.width / 2, canvas.height / 2, 350, 0, 2 * Math.PI);
            ctx.stroke();

        } else {
            ctx.fillStyle = '#fffcf5';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
    }

    function updateTimeline() {
        const progress = (currentTime / duration) * 100;
        timelineProgress.style.width = `${progress}%`;
    }

    function updateTimecode() {
        const currentMinutes = Math.floor(currentTime / 60).toString().padStart(2, '0');
        const currentSeconds = Math.floor(currentTime % 60).toString().padStart(2, '0');
        const durationMinutes = Math.floor(duration / 60).toString().padStart(2, '0');
        const durationSeconds = Math.floor(duration % 60).toString().padStart(2, '0');
        timecodeDisplay.textContent = `${currentMinutes}:${currentSeconds} / ${durationMinutes}:${durationSeconds}`;
    }

    function animationLoop(timestamp) {
        if (!startTime) startTime = timestamp;
        const dt = (timestamp - startTime) / 1000;
        startTime = timestamp;

        if (isPlaying) {
            currentTime += dt;
            if (currentTime > duration) {
                currentTime = 0;
            }
        }

        renderScene(currentTime);
        updateTimeline();
        updateTimecode();

        animationFrameId = requestAnimationFrame(animationLoop);
    }

    function playPause() {
        isPlaying = !isPlaying;
        playPauseBtn.textContent = isPlaying ? 'Pause' : 'Play';
    }

    function seek(event) {
        const rect = timeline.getBoundingClientRect();
        const x = event.clientX - rect.left;
        const progress = x / rect.width;
        currentTime = progress * duration;
        updateTimeline();
        updateTimecode();
    }

    function handleDurationChange() {
        duration = parseInt(durationInput.value);
        currentTime = 0;
        updateTimecode();
        updateTimeline();
    }

    function startRecording() {
        recordedChunks = [];
        const stream = canvas.captureStream(24);
        mediaRecorder = new MediaRecorder(stream, { mimeType: 'video/webm' });

        mediaRecorder.ondataavailable = event => {
            if (event.data.size > 0) {
                recordedChunks.push(event.data);
            }
        };

        mediaRecorder.onstop = () => {
            const blob = new Blob(recordedChunks, { type: 'video/webm' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'animation.webm';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            exportBtn.textContent = 'Export Video';
        };

        mediaRecorder.start();
        exportBtn.textContent = 'Stop Export';
    }

    function stopRecording() {
        mediaRecorder.stop();
    }

    function exportVideo() {
        if (mediaRecorder && mediaRecorder.state === 'recording') {
            stopRecording();
        } else {
            startRecording();
        }
    }

    playPauseBtn.addEventListener('click', playPause);
    timeline.addEventListener('click', seek);
    durationInput.addEventListener('input', handleDurationChange);
    exportBtn.addEventListener('click', exportVideo);

    animationLoop();
</script>
</body>
</html>